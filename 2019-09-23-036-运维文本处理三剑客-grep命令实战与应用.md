---
layout:     post
title:      运维文本处理三剑客-grep命令实战与应用
subtitle:   运维文本处理三剑客-grep命令实战与应用
date:       2019-09-23
author:     李广雄
header-img: img/post-bg-hacker.jpg
catalog: true
tags:
    - Linux练习题
---

# 运维文本处理三剑客-grep命令实战与应用

---
### 比较文件a.txt b.txt的内容
	
	[root@centos7 ~ 2019-09-23 04:32]$ diff a.txt b.txt 
	  
### 有文件f3,f4,制作一个比较文件的f3_f4.diff,以用来恢复文件

	[root@centos7 ~ 2019-09-23 04:41]$ diff -u f3 f4
	  
### 有文件f3,f4,有比较文件f3_f4.diff,因操作失误删除f4后,请用f4恢复
	
	[root@centos7 ~ 2019-09-23 04:41]$ diff -u f3 f4 > f3_f4_diff


### 找出ifconfig “网卡名”命令结果中本机的IPv4地址

	[root@centos7 ~ 2019-09-23 02:34]$ ifconfig | grep netmask | tr -s " " :| cut -d":" -f3
	192.168.56.103
	10.182.210.87
	127.0.0.1
	192.168.122.1


### 查出分区空间使用率的最大百分比值

	[root@centos7 ~ 2019-09-24 02:37]$ df |grep "/dev/sd" | tr -s " " : | cut -d":" -f1,5
	/dev/sda3:28%
	/dev/sda1:8%


### 查出用户UID最大值的用户名,UID及shell类型

	[root@centos7 ~ 2019-09-24 02:46]$ cat /etc/passwd | sort -t":" -k3 -nr | head -n1| cut -d":" -f1,3,7 --output-delimiter="@"
	nfsnobody@65534@/sbin/nologin


### 查出用户UID最第二大值的用户名,UID及shell类型

	[root@centos7 ~ 2019-09-24 02:46]$ cat /etc/passwd | sort -t":" -k3 -nr | head -n2 | tail -n1 | cut -d":" -f1,3,7 --output-delimiter="@"
	stone@1000@/bin/bash


### 查出/tmp的权限,以数字方式显示

	[root@centos7 ~ 2019-09-24 03:00]$ stat /tmp/ | grep Uid | cut -d"(" -f2 | cut -d"/" -f1

### 统计当前连接本机的每个远程主机IP的连接数,并按从大到小排序

	[root@centos7 ~ 2019-09-24 03:05]$ ss -n | grep :|tail -n 1 |tr -s " " : | cut -d":" -f7 | sort
	192.168.56.1


### 查看正则表达式帮助

	[root@mha ~ 15:28:22]$ paste -s /etc/issue
	\S	Kernel \r on an \m	

### /etc/passwd中显示包含root的行

	[root@centos7 ~ 2019-09-24 04:16]$ grep root /etc/passwd

### /etc/passwd中显示包含变量名$USER的行

	[root@centos7 ~ 2019-09-24 04:18]$ grep $USER /etc/passwd
	root:x:0:0:root:/root:/bin/bash
	operator:x:11:0:operator:/root:/sbin/nologin

### /etc/passwd中显示包含$USER的行

	[root@centos7 ~ 2019-09-24 04:18]$ grep '$USER' /etc/passwd

### /etc/passwd中显示包含命令whoami的行

	[root@centos7 ~ 2019-09-24 04:18]$ grep `whoami` /etc/passwd

### ifconfig 中包含 netmask行显示出来

	[root@centos7 ~ 2019-09-24 04:19]$ ifconfig | grep netmask
 

### centos6上给grep设置别名grep自动带颜色

	[root@mha ~ 15:58:12]$ alias grep= 'grep --color=auto'
	

### /etc/fstab上查找不被UUID匹配的行

	[root@centos7 ~ 2019-09-24 04:27]$ grep -v UUID /etc/fstab 
	
	#
	# /etc/fstab
	# Created by anaconda on Mon Sep 23 20:37:17 2019
	#
	# Accessible filesystems, by reference, are maintained under '/dev/disk'
	# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
	#



### /root/fstab忽略字符大小写查找UUID匹配的行

	[root@centos7 ~ 2019-09-24 04:27]$ grep -i uuid /root/fstab 
	UUID=2fc269a5-e669-41a5-b02e-d235cec03cff /                       xfs     defaults        0 0
	UUID=b0d652e4-0c0c-40c7-82c1-8b7626e880ed /boot                   xfs     defaults        0 0
	UUID=06549d51-a3fc-4db3-abc8-2398ba3c801b swap                    swap    defaults        0 0
	uuid=06549d51-a3fc-4db3-abc8-2398ba3c801b swap                    swap    defaults        0 0


### /etc/passwd查找root匹配的行显示匹配的行号

	[root@centos7 ~ 2019-09-24 04:22]$ grep -n UUID /etc/fstab 
	9:UUID=2fc269a5-e669-41a5-b02e-d235cec03cff /                       xfs     defaults        0 0
	10:UUID=b0d652e4-0c0c-40c7-82c1-8b7626e880ed /boot                   xfs     defaults        0 0
	11:UUID=06549d51-a3fc-4db3-abc8-2398ba3c801b swap                    swap    defaults        0 0
	


### /etc/passwd查找root统计匹配的行数

	[root@centos7 ~ 2019-09-24 04:29]$ grep -c root /etc/passwd
	2

### /etc/passwd查找root静默模式,不输出任何信息,脚本

	[root@mha ~ 16:05:43]$ grep -q root /etc/passwd	

### /etc/passwd查找root仅显示匹配到的字符串,正则表达式

	[root@centos7 ~ 2019-09-24 04:41]$ grep -on root /etc/passwd
	1:root
	1:root
	1:root
	10:root

### /etc/passwd上查找root匹配的行和后3行都显示

	[root@centos7 ~ 2019-09-24 04:42]$ grep -A3 root /etc/passwd
	root:x:0:0:root:/root:/bin/bash
	bin:x:1:1:bin:/bin:/sbin/nologin
	daemon:x:2:2:daemon:/sbin:/sbin/nologin
	adm:x:3:4:adm:/var/adm:/sbin/nologin
	--
	operator:x:11:0:operator:/root:/sbin/nologin
	games:x:12:100:games:/usr/games:/sbin/nologin
	ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
	nobody:x:99:99:Nobody:/:/sbin/nologin


### /etc/passwd上查找root匹配的行和前3行都显示

	[root@centos7 ~ 2019-09-24 04:42]$ grep -B3 root /etc/passwd
	root:x:0:0:root:/root:/bin/bash
	--
	shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
	halt:x:7:0:halt:/sbin:/sbin/halt
	mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
	operator:x:11:0:operator:/root:/sbin/nologin

### /etc/passwd上查找root匹配的行和前后3行都显示

	[root@centos7 ~ 2019-09-24 04:43]$ grep -C3 root /etc/passwd -n
	1:root:x:0:0:root:/root:/bin/bash
	2-bin:x:1:1:bin:/bin:/sbin/nologin
	3-daemon:x:2:2:daemon:/sbin:/sbin/nologin
	4-adm:x:3:4:adm:/var/adm:/sbin/nologin
	--
	7-shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
	8-halt:x:7:0:halt:/sbin:/sbin/halt
	9-mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
	10:operator:x:11:0:operator:/root:/sbin/nologin
	11-games:x:12:100:games:/usr/games:/sbin/nologin
	12-ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
	13-nobody:x:99:99:Nobody:/:/sbin/nologin


### /etc/passwd查找root或者stone的字符串

	[root@centos7 ~ 2019-09-24 04:45]$ grep -e 'root' -e 'stone' /etc/passwd
	root:x:0:0:root:/root:/bin/bash
	operator:x:11:0:operator:/root:/sbin/nologin
	stone:x:1000:1000:stone:/home/stone:/bin/bash


### /etc/passwd查找root并且包含bash的字符串

	[root@centos7 ~ 2019-09-24 04:46]$ grep 'root' /etc/passwd | grep 'bash'
	root:x:0:0:root:/root:/bin/bash


### /etc/fstab上查找UUID匹配整个单词行

	[root@mha ~ 16:17:13]$ cut -d":" -f1,3 /etc/passwd | sort -t":" -k2 -r

### grep egrep fgrep的区别是什么
	grep 支持正则表达式
    grep -E=egrep 支持扩展正则表达式
	fgrep 不支持正则表达式

## 参考资料
	